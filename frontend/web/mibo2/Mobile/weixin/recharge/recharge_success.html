<!DOCTYPE html>
<html>
<head>	
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection"content="telephone=no, email=no" />
    <title>充值成功</title>
    <link rel="stylesheet" href="css/weixin/style.css">
    <style>
        #removeAd ~*{
            display: none;
        }
    </style>
</head>
<body class="p-recharge">
    <div class="tip-info" id="loading">
        <p style="width:100px;margin:0 auto;text-align:left;">订单查询中<i>...</i></p>  
    </div>
	<div class="tip-info" id="success" style="display:none;">
        <span>充值成功！</span> 
        <p>请到蜜播app中查看账户余额</p>  
    </div>
    <div class="tip-info" id="error" style="display:none;">
        <span style="color:red;">支付异常！</span> 
    </div>
    <script src="http://mblive.oss-cn-hangzhou.aliyuncs.com/mblive/js/jquery-2.0.3.min.js"></script>
<script src="js/component/pop.js"></script>
<script>
    function getUrlParam(name){
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg); //匹配目标参数
        if (r != null) return unescape(r[2]);
        return null; //返回参数值
    }
    function getStatu(){
        if(getUrlParam('type') == 1)
        {
            $.ajax({
            url: '/mbliving/rechargeresult',
            type: 'POST',
            data: {
               bill_no: getUrlParam('bill_no'),
               // goods_type:getUrlParam('type')
            },
            success: function(data){
                    //popInfo(data,1);
                    //alert('datatype:'+(typeof data));
                    //alert(data);
                    data = data&&JSON.parse(data)
                    if(data.code==0){
                        //alert(data.code);
                        clearInterval(timer);
                        //支付成功
                        $('#loading').hide();
                        $('#success').show();

                    }else if(data.code==1){
                        //支付异常
                        clearInterval(timer);
                        $('#loading').hide();
                        $('#error').show();
                        //停止查询
                        
                    }else{
                        //支付中继续查询
                    }
                }
            })
        }
        else if(getUrlParam('type') == 2)
        {
             $.ajax({
            url: '/mbliving/wxgoldresult',
            type: 'POST',
            data: {
               bill_no: getUrlParam('bill_no'),
               // goods_type:getUrlParam('type')
            },
            success: function(data){
                    //popInfo(data,1);
                    //alert('datatype:'+(typeof data));
                    //alert(data);
                    data = data&&JSON.parse(data)
                    if(data.code==0){
                        //alert(data.code);
                        clearInterval(timer);
                        //支付成功
                        $('#loading').hide();
                        $('#success').show();

                    }else if(data.code==1){
                        //支付异常
                        clearInterval(timer);
                        $('#loading').hide();
                        $('#error').show();
                        //停止查询
                        
                    }else{
                        //支付中继续查询
                    }
                }
            })
        }
}




        
    getStatu();
    var timer = setInterval(getStatu, 5000);
    

    
    var num = 1;
    function loading(){
        if(num==3){
            $('#loading i').html('...');
            num = 1;
        }else if(num==2){
            $('#loading i').html('..');
            num++;
        }else{
            $('#loading i').html('.');
            num++;
        }
        
    }
    setInterval(loading, 500);
</script>  
<div id="removeAd"></div>
</body> 

</html>
