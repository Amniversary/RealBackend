var $curEle;window.onload=function(){function e(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}function t(){0==o?(r.attr("disabled",!1),r.val("重新获取"),o=59,clearTimeout(i)):(r.attr("disabled",!0),r.val(o+"s"),o--,i=setTimeout(t,1e3))}$("#j_refer").on("touchstart",function(){$("#j_refer_alert").show()}),$("#j_refer_alert").on("touchstart",function(){$(this).hide()});var n=$(".add-img").width();$(".add-img").css("height",n+1),$(".add-img").css("width",n),$(".add-img img").css({position:"absolute",left:"50%",top:"50%","-webkit-transform":"translate(-50%, -50%)"}),$(".add-img").on("click",function(){$(".moxie-shim input").click(),$curEle=$(this).parents("li")}),app_id=e("app_id"),rand_str=e("rand_str"),time=e("time"),unique_no=e("unique_no"),p_sign=e("p_sign"),1171658345==app_id&&$(".btn-yellow").css("background-color","#fc5176"),$("#j_get").on("touchstart",function(){var e=$(this),n=$("[name=phone_num]").val().trim();/^(13|14|15|18)[0-9]{9}$/.test(n)?$.ajax({url:"/mbliving/livingsendverify",type:"POST",data:{phone_num:n},success:function(n){n=n&&JSON.parse(n),"ok"==n.error_msg?t(e):popInfo(n.error_msg,1)}}):""!=n?popInfo("请输入正确的手机号码",1):popInfo("请输入手机号码哦",1)});{var i,o=59,r=$("#j_get"),a=Backbone.Model.extend({url:"/mbliving/livingapprove",defaults:{actual_name:"",id_card:""},validate:function(e){if(""==e.actual_name)return"真实姓名不能为空哦";var t=/^[\u4e00-\u9fa5]{2,6}$/;if(!t.test(e.actual_name))return"请输入正确的真实姓名";if(""==e.id_card)return"身份证号码不能为空哦";console.log(e.id_card.length);var t=/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/;return t.test(e.id_card)?""==e.p_sign?"缺少签名":""==e.unique_no?"缺少用户唯一号":""==e.rand_str?"缺少随机字符串":""==e.time?"缺少时间戳":void 0:"请输入正确的身份证号码"}}),s=Backbone.View.extend({el:$("#j_form"),events:{"touchstart #j_submit":"submitForm"},initialize:function(){this.model=new a,this.listenTo(this.model,"invalid",this.alertErrorMsg)},submitForm:function(){this.getFormInfo(),this.model.set({rand_str:rand_str,time:time,unique_no:unique_no,p_sign:p_sign,app_id:app_id}),this.model.save({},{success:function(e,t){"ok"==t.error_msg?(popInfo(t.error_msg,0),setTimeout(function(){window.location.href="approve_success.html"},2e3),window.ApproveWebView.onsuccess()):popInfo(t.error_msg,1)}})},getFormInfo:function(){var e=$("#j_form").serializeArray(),t=this;_.each(e,function(e){t.model.set(e.name,e.value)})},alertErrorMsg:function(e,t){popInfo(t,1)}});new s}};