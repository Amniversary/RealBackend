function send_request(){var e=null;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),null!=e?(serverUrl="./php/get.php",e.open("GET",serverUrl,!1),e.send(null),e.responseText):void alert("Your browser does not support XMLHTTP.")}function check_object_radio(){for(var e=document.getElementsByName("myradio"),t=0;t<e.length;t++)if(e[t].checked){g_object_name_type=e[t].value;break}}function get_signature(){if(now=timestamp=Date.parse(new Date)/1e3,now+3>expire){body=send_request();var obj=eval("("+body+")");return host=obj.host,policyBase64=obj.policy,accessid=obj.accessid,signature=obj.signature,expire=parseInt(obj.expire),callbackbody=obj.callback,key=obj.dir,!0}return!1}function random_string(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,o="";for(i=0;e>i;i++)o+=t.charAt(Math.floor(Math.random()*n));return o}function get_suffix(e){return pos=e.lastIndexOf("."),suffix="",-1!=pos&&(suffix=e.substring(pos)),suffix}function calculate_object_name(e){return"local_name"==g_object_name_type?g_object_name+="${filename}":"random_name"==g_object_name_type&&(suffix=get_suffix(e),g_object_name=key+random_string(10)+suffix),""}function get_uploaded_object_name(e){return"local_name"==g_object_name_type?(tmp_name=g_object_name,tmp_name=tmp_name.replace("${filename}",e)):"random_name"==g_object_name_type?g_object_name:void 0}function set_upload_param(e,t,n){0==n&&(n=get_signature()),g_object_name=key,""!=t&&(suffix=get_suffix(t),calculate_object_name(t)),new_multipart_params={key:g_object_name,policy:policyBase64,OSSAccessKeyId:accessid,success_action_status:"200",callback:callbackbody,signature:signature},e.setOption({url:host,multipart_params:new_multipart_params}),e.start()}accessid="",accesskey="",host="",policyBase64="",signature="",callbackbody="",filename="",key="",expire=0,g_object_name="",g_object_name_type="",now=timestamp=Date.parse(new Date)/1e3;var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"selectfiles",multi_selection:!1,flash_swf_url:"../../libs/plupload/Moxie.swf",silverlight_xap_url:"../../libs/plupload/Moxie.xap",url:"http://oss.aliyuncs.com",filters:{max_file_size:"10mb"},init:{PostInit:function(){document.getElementById("ossfile").innerHTML="",document.getElementById("postfiles").onclick=function(){return set_upload_param(uploader,"",!1),!1}},FilesAdded:function(e,t){$("#j_progress a").text("0%"),$("#j_progress").show(),t.length>3&&(console.log(popInfo("最多只能上传3张照片哦",1)),t.splice(3,t.length),console.log(t)),plupload.each(t,function(e){document.getElementById("ossfile").innerHTML+='<div id="'+e.id+'">'+e.name+" ("+plupload.formatSize(e.size)+')<b></b><div class="progress"><div class="progress-bar" style="width: 0%"></div></div></div>'}),$("#postfiles").click()},BeforeUpload:function(e,t){check_object_radio(),set_upload_param(e,t.name,!0)},UploadProgress:function(e,t){var n=document.getElementById(t.id);n.getElementsByTagName("b")[0].innerHTML="<span>"+t.percent+"%</span>";var o=n.getElementsByTagName("div")[0],a=o.getElementsByTagName("div")[0];a.style.width=2*t.percent+"px",a.setAttribute("aria-valuenow",t.percent),$("#j_progress a").text(t.percent+"%")},FileUploaded:function(e,t,n){if(200==n.status){document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML="upload to oss success, object name:"+get_uploaded_object_name(t.name);var o=host+"/"+get_uploaded_object_name(t.name);$curEle.find("img").attr("src",o),$curEle.find("input").val(o),console.log($curEle.find("input").val()),$curEle.find("img").load(function(){$(this).css($(this).width()>$(this).height()?{height:"100%",width:"auto"}:{height:"auto",width:"100%"}),$("#j_progress").hide()})}else document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML=n.response},Error:function(e,t){-600==t.code?popInfo("\n选择的文件太大了,可以根据应用情况，在upload.js 设置一下上传的最大大小",1):-601==t.code?popInfo("\n选择的文件后缀不对,可以根据应用情况，在upload.js进行设置可允许的上传文件类型",1):-602==t.code?popInfo("这个照片已经选择过了哦",1):popInfo("\nError xml:"+t.response,1)}}});uploader.init();