
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="Content-Security-Policy" content="default-src gap://ready file:; style-src 'self' 'unsafe-inline'; script-src 'unsafe-inline' 'unsafe-eval'">
    <meta http-equiv="Access-Control-Allow-Origin" content="http://mibo.matewish.cn:80">
    <meta name="format-detection"content="telephone=no, email=no" />
    <title>收货信息</title>

    <link rel="stylesheet" type="text/css" href="css/address.css">
    <link rel="stylesheet" type="text/css" href="css/sweetalert.css">
	<script src="https://mblive.oss-cn-hangzhou.aliyuncs.com/mblive/js/jquery-2.0.3.min.js"></script>
	<script type="text/javascript" src="js/sweetalert.min.js"></script>
	<link rel="stylesheet" href="css/LArea.css">
    <style>
    	.gearArea ~*{
		display: none;
    	}
    </style>
</head>


<body class="wrap">

	<!--  html文件 -->
	<div class="content">
		<p class="hint">
			为了方便工作人员及时为您<br/>发放奖品，请您如实填写领奖资料。</p>
		<div class="address">
			<span>真实姓名：</span>
			<input type="text"  class="user-name" placeholder="请输入您的真实姓名"  />
		</div>
		<div class="address">
			<span>手机号码：</span>
			<input  type="number"  class="phone" oninput="checkTextLength( this , 11)" placeholder="请输入真实有效的手机号码" />
		</div>
		<div class="address">
			<span>收货地区：</span>
			  <div class="content-block" style="display:inline-block">
			            <input id="demo1" style="width:100%"  class="user-address1" type="text" readonly="" placeholder="城市选择特效"  value="广东省,深圳市,南山区"/>
			            <input id="value1" type="hidden" value="20,234,504"/>
			  </div>
		</div>
		<div class="address1">
			<span>详细地址：</span>
			<textarea class="user-address2" placeholder="请输入您的详细地址"></textarea>
		</div>
		<div class="save">
			<a>提交</a>
		</div>
	</div>


	<!-- 页面展示和页面按钮点击后的处理 -->
	<script type="text/javascript">
		var urls = localStorage.getItem("url");
		var mystr = this.location.href;


		function checkTextLength(obj, length) {   
    
		           if(obj.value.length > length)   {   
		                
		               obj.value = obj.value.substr(0, length);   
		           }   
			   
		}

		//获取地址栏上参数的方法
		function lookup(x) {
		        var index1 = mystr.indexOf(x);
		        var index = x.length;
		        var index_1 = mystr.indexOf("&", index1);
		        if (index_1 == -1) {
		            index_1 = mystr.length;
		        }
		        var index1s = mystr.substring(index1 + index + 1, index_1);
		        return index1s;
		 }

		 //进入页面时展示接口
		$.ajax({
                            url:"/integral/show_address_info",
                             //请求的url地址
                            dataType: "json",   //返回格式为json
                            async: true, //请求是否异步，默认为异步，这也是ajax重要特性
                            type: "post",   //请求方式
                            data:{'user_id':lookup("user_id")},
                            success: function(data) {
	                          //请求成功时处理
	                          if(data.msg['user_name'] != undefined){
	                          	$(".user-name").val(data.msg['user_name']);
	                          }
	                          if(data.msg['phone'] != undefined){
	                          	$(".phone").val(data.msg['phone']);
	                          }
	                          if(data.msg['address'] != undefined){
	                          	var address = data.msg['address'].split("——")
	                          	$(".user-address1").val(address[0]);
	                          	$(".user-address2").val(address[1]);
	                          }            
                            },
                            error: function() {
                                //请求出错处理
                                swal({
                                    title: "请求数据出错了",
                                    type: "error",
                                    showCancelButton: false,
                                    closeOnConfirm: false,
                                    confirmButtonText: "确定",
                                    confirmButtonColor: "#6ffabc"
                                },function(){
                                 	window.location.href = urls;
                                })
                           }
                        });


		$(".save").click(function(){
			$.ajax({
	                            url:"/integral/save_user_address",
	                             //请求的url地址
	                            dataType: "json",   //返回格式为json
	                            async: true, //请求是否异步，默认为异步，这也是ajax重要特性
	                            type: "post",   //请求方式
	                            data:{'user_name':$(".user-name").val(),'phone':$(".phone").val(),'adress':$(".user-address1").val()+"——"+$(".user-address2").val(),'user_id':lookup("user_id"),'gift_order':lookup("gift_order"),'gift_type':400},
	                            success: function(data) {
	                                     	//请求成功时处理 1代表出现正常错误
		                          	if (data.code == "1") {
	                              			alert(data.msg)
		                              	}
		                              	else if(data.code == "0"){
		                              		window.location.href = urls+"&is_success=1";
		                              	}
	                            },
	                            error: function() {
	                                //请求出错处理
	                                swal({
	                                    title: "数据请求出错了",
	                                    type: "error",
	                                    showCancelButton: false,
	                                    closeOnConfirm: false,
	                                    confirmButtonText: "确定",
	                                    confirmButtonColor: "#6ffabc"
	                                },function(){
	                                 window.location.href = urls;
	                                })
	                           }
	                        });
		})
	</script>

	<!-- APP端点击返回需要调用的方法 -->
	<script type="text/javascript">
		function back(){
			window.location.href = urls;
		}
	</script>


	<!-- 增加地址的ios特效 -->
	<script src="js/LAreaData1.js"></script>
	<script src="js/LAreaData2.js"></script>
	<script src="js/LArea.js"></script>
	<script>
	    var area1 = new LArea();
	    area1.init({
	        'trigger': '#demo1', //触发选择控件的文本框，同时选择完毕后name属性输出到该位置
	        'valueTo': '#value1', //选择完毕后id属性输出到该位置
	        'keys': {
	            id: 'id',
	            name: 'name'
	        }, //绑定数据源相关字段 id对应valueTo的value属性输出 name对应trigger的value属性输出
	        'type': 1, //数据源类型
	        'data': LAreaData //数据源
	    });
	    area1.value=[1,13,3];//控制初始位置，注意：该方法并不会影响到input的value
	    var area2 = new LArea();
	    area2.init({
	        'trigger': '#demo2',
	        'valueTo': '#value2',
	        'keys': {
	            id: 'value',
	            name: 'text'
	        },
	        'type': 2,
	        'data': [provs_data, citys_data, dists_data]
	    });
	    </script>

	<!-- <div id="end"></div> -->
</body>
</html>